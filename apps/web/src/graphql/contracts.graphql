query GetContractsWithFilter($filter: ContractFilterInput, $skip: Int, $take: Int, $orderBy: ContractOrderInput) {
  contracts(filter: $filter, skip: $skip, take: $take, orderBy: $orderBy) {
    nodes {
      id
      contractNo
      name
      type
      status
      ourEntity
      amountWithTax
      currency
      signedAt
      expiresAt
      parseStatus
      createdAt
      customer {
        id
        name
        shortName
      }
      department {
        id
        name
        code
      }
    }
    totalCount
    hasNextPage
    hasPreviousPage
  }
}

query GetContract($id: ID!) {
  contract(id: $id) {
    id
    contractNo
    name
    type
    status
    ourEntity
    amountWithTax
    amountWithoutTax
    currency
    taxRate
    taxAmount
    paymentMethod
    paymentTerms
    signedAt
    effectiveAt
    expiresAt
    duration
    fileUrl
    fileType
    industry
    salesPerson
    parseStatus
    parsedAt
    parseConfidence
    needsManualReview
    createdAt
    updatedAt
    customer {
      id
      name
      shortName
      creditCode
      industry
      address
      contactPerson
      contactPhone
      contactEmail
    }
    department {
      id
      name
      code
    }
    uploadedBy {
      id
      name
      email
    }
    basicInfo {
      id
      projectName
      projectOverview
      projectStartDate
      projectEndDate
      warrantyStartDate
      warrantyPeriodMonths
      acceptanceMethod
      acceptancePeriodDays
      deemedAcceptanceRule
      confidentialityTermYears
      confidentialityDefinition
      confidentialityObligation
      governingLaw
      disputeResolutionMethod
      noticeRequirements
    }
  }
}

mutation CreateContract($input: CreateContractInput!) {
  createContract(input: $input) {
    id
    contractNo
    name
  }
}

mutation UpdateContractById($id: ID!, $input: UpdateContractInput!) {
  updateContract(id: $id, input: $input) {
    id
    contractNo
    name
    status
  }
}

mutation DeleteContract($id: ID!) {
  deleteContract(id: $id)
}

mutation ParseAndExtract($objectName: String!) {
  parseAndExtract(objectName: $objectName) {
    success
    text
    pageCount
    extractedFields {
      contractNumber
      contractName
      partyA
      partyB
      signDate
      amount
      validPeriod
      rawMatches {
        field
        value
        confidence
      }
    }
  }
}

mutation ConvertUploadedFileToMarkdown($objectName: String!, $options: DoclingConvertOptions, $skipCache: Boolean) {
  convertUploadedFileToMarkdown(objectName: $objectName, options: $options, skipCache: $skipCache) {
    success
    markdown
    pages
    tables {
      markdown
      rows
      cols
    }
    images {
      page
      width
      height
    }
    error
    fromCache
  }
}

mutation DetectContractType($markdown: String!, $fileName: String) {
  detectContractType(markdown: $markdown, fileName: $fileName) {
    detectedType
    confidence
    reasoning
    displayName
    description
  }
}

mutation CreateParseSession($objectName: String!) {
  createParseSession(objectName: $objectName)
}

mutation ParseContractWithLlm($objectName: String!) {
  parseContractWithLlm(objectName: $objectName) {
    success
    extractedData {
      contractType
      basicInfo {
        contractNo
        contractName
        ourEntity
        customerName
        status
        # 合同元数据
        version
        governingLanguage
        # 甲方详细信息
        clientLegalRep
        clientRegistrationNumber
        clientBusinessLicense
        clientAddress
        clientContactPerson
        clientPhone
        clientEmail
        clientFax
        clientBankName
        clientBankAccount
        clientAccountName
        # 乙方详细信息
        vendorLegalRep
        vendorRegistrationNumber
        vendorBusinessLicense
        vendorAddress
        vendorContactPerson
        vendorPhone
        vendorEmail
        vendorFax
        vendorBankName
        vendorBankAccount
        vendorAccountName
        # 项目基本信息
        projectName
        projectOverview
        # 项目时间信息
        projectStartDate
        projectEndDate
        warrantyStartDate
        warrantyPeriodMonths
        # 财务信息
        isTaxInclusive
        pricingModel
        # 验收信息
        acceptanceMethod
        acceptancePeriodDays
        deemedAcceptanceRule
        # 保密条款
        confidentialityTermYears
        confidentialityDefinition
        confidentialityObligation
        # 通用条款
        governingLaw
        disputeResolutionMethod
        noticeRequirements
      }
      financialInfo {
        amountWithTax
        amountWithoutTax
        taxRate
        currency
        paymentMethod
        paymentTerms
      }
      timeInfo {
        signedAt
        effectiveAt
        expiresAt
        duration
      }
      otherInfo {
        salesPerson
        industry
        signLocation
        copies
      }
      typeSpecificDetails
    }
    rawText
    pageCount
    llmModel
    llmProvider
    processingTimeMs
    sessionId
    error
  }
}

mutation StartParseContractAsync($objectName: String!, $strategy: ParseStrategyType, $markdown: String) {
  startParseContractAsync(objectName: $objectName, strategy: $strategy, markdown: $markdown) {
    sessionId
    message
  }
}

query GetParseProgress($sessionId: String!) {
  getParseProgress(sessionId: $sessionId) {
    sessionId
    objectName
    status
    currentStage
    totalChunks
    completedChunks
    currentChunkIndex
    progressPercentage
    chunks {
      chunkId
      chunkIndex
      totalChunks
      purpose
      status
      startTime
      endTime
      error
    }
    totalTasks
    completedTasks
    currentTaskInfo
    tasks {
      taskId
      infoType
      infoTypeName
      status
      startTime
      endTime
      error
      data
    }
    startTime
    estimatedEndTime
    processingTimeMs
    error
    extractedFieldsCount
    estimatedRemainingSeconds
    currentTokenSpeed
    averageTokenSpeed
    totalTokensUsed
    resultData
  }
}

query CheckContractDuplicate($contractNo: String!) {
  checkContractDuplicate(contractNo: $contractNo) {
    isDuplicate
    existingContract {
      id
      contractNo
      name
      type
      status
      ourEntity
      amountWithTax
      amountWithoutTax
      currency
      signedAt
      effectiveAt
      expiresAt
      paymentMethod
      paymentTerms
      customer {
        id
        name
      }
      department {
        id
        name
      }
    }
    message
  }
}

mutation CreateOrUpdateContract($input: CreateContractInput!, $forceUpdate: Boolean, $operatorId: ID) {
  createOrUpdateContract(input: $input, forceUpdate: $forceUpdate, operatorId: $operatorId) {
    id
    contractNo
    name
    type
    status
    amountWithTax
    signedAt
    customer {
      id
      name
    }
  }
}

mutation CleanupMarkdown($contractId: String!, $useLlm: Boolean) {
  cleanupMarkdown(contractId: $contractId, useLlm: $useLlm) {
    markdown
    cleanupInfo {
      cleanedText
      originalLength
      cleanedLength
      linesRemoved
      corrections
      method
      llmTokensUsed
    }
    success
    error
  }
}

mutation CleanupMarkdownText($markdownText: String!, $useLlm: Boolean) {
  cleanupMarkdownText(markdownText: $markdownText, useLlm: $useLlm) {
    markdown
    cleanupInfo {
      cleanedText
      originalLength
      cleanedLength
      linesRemoved
      corrections
      method
      llmTokensUsed
    }
    success
    error
  }
}
